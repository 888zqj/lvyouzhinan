import{h as q,aM as F,a4 as P,aN as G,v as l,c as H,o as S,b as z,l as e,k as o,z as s,C as J,t as K,a5 as X,B as Y,a8 as Z,aO as ee,e as V,aP as ae,V as B,A as te,a9 as n,aQ as le,aR as oe,aS as se,ac as ne,aT as re,aU as ue,aV as ie,aW as ce}from"./index-de307950.js";const m=c=>(ie("data-v-3a0acbde"),c=c(),ce(),c),de={class:"leftArea"},pe=m(()=>s("h1",{style:{"text-align":"center"}},"上传图片",-1)),_e={class:"img-container"},me={class:"rightArea"},ve=m(()=>s("h1",{style:{"text-align":"center"}},"内容区",-1)),ge={class:"content-container"},fe=m(()=>s("div",{style:{margin:"49.9987px 0"}},null,-1)),he=m(()=>s("br",null,null,-1)),we=["src"],xe={key:0,class:"overlay"},ye={__name:"index",setup(c){const v=F(),d=P(),T=()=>{d.userInfo.id||v.replace("/login")};G(()=>T());const p=l([]),g=H(()=>p.value.map(a=>a.url)),u=l(""),_=l(""),f=l(""),h=l(!1),b=l({}),k=l({}),I=l(0),M=a=>(f.value=a.url,h.value=!0,!0);console.log("为什么上传失败"),console.log("打印一下",f.value);const N=async a=>{n({type:"warning",message:"图片上传失败"}),P(),await v.replace("/")},R=(a,t)=>{if(["image/jpeg","image/png","image/gif"].includes(a.raw.type)){if(a.raw.size/1024/1024>2)return n.error("文件大小最多2MB!"),i.value.handleRemove(a),!1}else return n.error("请上传正确的图片文件!"),i.value.handleRemove(a),!1;return!0},i=l(null),L=a=>{k.value={id:I.value}},A=async()=>{if(g.value.length===0){n.warning("请至少上传一张图片!");return}if(u.value===""){n.warning("请输入标题");return}const a={title:u.value,content:_.value,user_id:d.userInfo.id},t=await le(a);I.value=t.info,console.log("开始打印了"),console.log(i.value),i.value.submit(),n({type:"success",message:"发布成功，3秒后跳转到主页"}),setTimeout(()=>{v.replace("/")},3e3)},D=()=>{n.warning("最多可以添加9张图片哦!")},w=l(!1),j=()=>{w.value=!1},O=()=>{if(g.value.length===0){n.warning("请至少上传一张图片!");return}if(u.value===""){n.warning("请输入标题");return}b.value={id:1,title:u.value,content:_.value,user:d.userInfo,imgs:g.value,createTime:oe()},w.value=!0},Q=[p];return(a,t)=>{const x=Y,C=se,y=ne,E=re,U=ue,W=Z,$=ee;return S(),z(X,null,[e(W,{gutter:50},{default:o(()=>[e(y,{span:500},{default:o(()=>[s("div",de,[pe,s("div",_e,[e(C,{"file-list":p.value,"onUpdate:fileList":t[0]||(t[0]=r=>p.value=r),action:"http://localhost:8000/upload/",class:"preview",ref_key:"upload",ref:i,"list-type":"picture-card",multiple:"",headers:V(d).headersObj,limit:9,"on-preview":M,"on-change":R,"auto-upload":!1,"on-exceed":D,data:k.value,"before-upload":L,"on-error":N},{default:o(()=>[e(x,null,{default:o(()=>[e(V(ae))]),_:1})]),_:1},8,["file-list","headers","data"])])])]),_:1}),e(y,{span:500},{default:o(()=>[s("div",me,[ve,s("div",ge,[e(E,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=r=>u.value=r),maxlength:"20",placeholder:"请输入标题","show-word-limit":"",type:"text",style:{"margin-top":"19.9988px",width:"80%","margin-left":"49.9987px"}},null,8,["modelValue"]),fe,e(E,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=r=>_.value=r),maxlength:"3000",placeholder:"请输入内容","show-word-limit":"",type:"textarea",style:{width:"80%","margin-left":"49.9987px"},autosize:""},null,8,["modelValue"])])])]),_:1}),e(y,{span:50},{default:o(()=>[e(U,{style:{"margin-top":"150px",color:"white"},round:"",color:"#fd5656",size:"large",onClick:A},{default:o(()=>[B("发布推文 ")]),_:1}),he,e(U,{style:{"margin-top":"199.9988px"},round:"",type:"primary",size:"large",onClick:O},{default:o(()=>[B("生成预览")]),_:1})]),_:1})]),_:1}),e($,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=r=>h.value=r)},{default:o(()=>[s("img",{src:f.value,alt:"Preview Image"},null,8,we)]),_:1},8,["modelValue"]),w.value?(S(),z("div",xe,[s("button",{class:"backPage",onClick:j},[e(x,null,{default:o(()=>[e(V(te))]),_:1})]),e(J,{detail:b.value,comments:Q,review:!0},null,8,["detail"])])):K("",!0)],64)}}},be=q(ye,[["__scopeId","data-v-3a0acbde"]]);export{be as default};
